<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tailoring Management Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
        }

        html {
            height: 100%;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            margin: 0;
            color: #667eea;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }

        .tab-button {
            flex: 1;
            min-width: 150px;
            padding: 15px 25px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            box-shadow: 0 6px 20px rgba(118, 75, 162, 0.6);
        }

        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .measurement-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .measurement-section h3 {
            margin-top: 0;
            color: #667eea;
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .btn {
            padding: 15px 35px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            margin-left: 10px;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .search-section {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .search-grid {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        .customer-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .customer-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .customer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .customer-name {
            font-size: 1.4em;
            font-weight: 700;
            color: #667eea;
        }

        .customer-phone {
            color: #666;
            font-size: 1.1em;
        }

        .customer-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }

        .measurements-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .measurement-item {
            background: #f8f9ff;
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }

        .measurement-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 3px;
        }

        .measurement-value {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }

        .garment-type-badge {
            display: inline-block;
            padding: 5px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.4);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        tr:hover {
            background: #f8f9ff;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1em;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .date-filter-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .search-grid, .filter-grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .tab-button {
                width: 100%;
            }

            h1 {
                font-size: 1.8em;
            }

            .customer-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
    <style>@view-transition { navigation: auto; }</style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
    <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
    <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>
<body>
<div class="container">
    <header>
        <h1>‚úÇÔ∏è Tailoring Management Dashboard</h1>
    </header>
    <nav class="nav-tabs"><button class="tab-button active" onclick="switchTab('customer-form')">Add Customer</button> <button class="tab-button" onclick="switchTab('search-customer')">Search Customer</button> <button class="tab-button" onclick="switchTab('all-customers')">All Customers</button> <button class="tab-button" onclick="switchTab('analytics')">Analytics</button> <button class="tab-button" onclick="switchTab('revenue-report')">Revenue Report</button>
    </nav>
    <main><!-- Add Customer Tab -->
        <div id="customer-form" class="tab-content active">
            <h2 style="color: #667eea; margin-bottom: 25px;">Customer Information</h2>
            <div id="alert-container"></div>
            <form id="customerForm" onsubmit="saveCustomer(event)">
                <div class="form-grid">
                    <div class="form-group"><label for="customerName">Customer Name *</label> <input type="text" id="customerName" required>
                    </div>
                    <div class="form-group"><label for="phoneNumber">Phone Number *</label> <input type="tel" id="phoneNumber" required>
                    </div>
                    <div class="form-group"><label for="address">Address</label> <input type="text" id="address">
                    </div>
                    <div class="form-group"><label for="workDate">Work Date *</label> <input type="date" id="workDate" required>
                    </div>
                    <div class="form-group"><label for="deliveryDate">Delivery Date</label> <input type="date" id="deliveryDate">
                    </div>
                    <div class="form-group"><label for="workType">Work Type *</label> <select id="workType" required> <option value="">Select Work Type</option> <option value="Stitching">Stitching</option> <option value="Alteration">Alteration</option> <option value="Repair">Repair</option> <option value="Design">Design</option> <option value="Embroidery">Embroidery</option> </select>
                    </div>
                    <div class="form-group"><label for="garmentType">Garment Type *</label> <select id="garmentType" required onchange="showMeasurementFields()"> <option value="">Select Garment Type</option> <option value="blouse">Blouse</option> <option value="lehenga">Lehenga</option> <option value="frock">Frock</option> <option value="kurti">Kurti</option> <option value="pant">Pant</option> </select>
                    </div>
                    <div class="form-group"><label for="billAmount">Bill Amount (‚Çπ) *</label> <input type="number" id="billAmount" step="0.01" required>
                    </div>
                </div><!-- Blouse Measurements (Common for all garment types) -->
                <div id="blouse-measurements" class="measurement-section" style="display: none;">
                    <h3>üìè Blouse Measurements</h3>
                    <div class="form-grid">
                        <div class="form-group"><label for="blouse_type">Blouse Type</label> <select id="blouse_type"> <option value="">Select Blouse Type</option> <option value="Princess Cut">Princess Cut</option> <option value="Single Dart">Single Dart</option> <option value="Kateri">Kateri</option> <option value="Padded">Padded</option> </select>
                        </div>
                        <div class="form-group"><label for="blouse_full_length">Full Length</label> <input type="text" id="blouse_full_length" placeholder="e.g., 15 inches">
                        </div>
                        <div class="form-group"><label for="blouse_shoulder">Shoulder</label> <input type="text" id="blouse_shoulder">
                        </div>
                        <div class="form-group"><label for="blouse_arm_hole">Arm Hole</label> <input type="text" id="blouse_arm_hole">
                        </div>
                        <div class="form-group"><label for="blouse_dot_point">Dot Point</label> <input type="text" id="blouse_dot_point">
                        </div>
                        <div class="form-group"><label for="blouse_upper_chest">Upper Chest</label> <input type="text" id="blouse_upper_chest">
                        </div>
                        <div class="form-group"><label for="blouse_lower_chest">Lower Chest</label> <input type="text" id="blouse_lower_chest">
                        </div>
                        <div class="form-group"><label for="blouse_chest">Chest</label> <input type="text" id="blouse_chest">
                        </div>
                        <div class="form-group"><label for="blouse_point_to_apex">Point to Apex Point</label> <input type="text" id="blouse_point_to_apex">
                        </div>
                        <div class="form-group"><label for="blouse_sleeve_length">Sleeve Length</label> <input type="text" id="blouse_sleeve_length">
                        </div>
                        <div class="form-group"><label for="blouse_biceps">Biceps</label> <input type="text" id="blouse_biceps">
                        </div>
                        <div class="form-group"><label for="blouse_front_neck_depth">Front Neck Depth</label> <input type="text" id="blouse_front_neck_depth">
                        </div>
                        <div class="form-group"><label for="blouse_back_neck_depth">Back Neck Depth</label> <input type="text" id="blouse_back_neck_depth">
                        </div>
                    </div>
                </div><!-- Lehenga Measurements -->
                <div id="lehenga-measurements" class="measurement-section" style="display: none;">
                    <h3>üìè Lehenga Measurements</h3>
                    <div class="form-grid">
                        <div class="form-group"><label for="lehenga_full_length">Full Length</label> <input type="text" id="lehenga_full_length" placeholder="e.g., 40 inches">
                        </div>
                        <div class="form-group"><label for="lehenga_waist">Waist</label> <input type="text" id="lehenga_waist">
                        </div>
                        <div class="form-group"><label for="lehenga_type">Lehenga Type</label> <select id="lehenga_type"> <option value="">Select Type</option> <option value="Pleats">Pleats</option> <option value="Gather">Gather</option> <option value="Umbrella">Umbrella</option> </select>
                        </div>
                    </div>
                </div><!-- Frock Measurements -->
                <div id="frock-measurements" class="measurement-section" style="display: none;">
                    <h3>üìè Frock Measurements</h3>
                    <div class="form-grid">
                        <div class="form-group"><label for="frock_body_length">Body Length</label> <input type="text" id="frock_body_length" placeholder="e.g., 38 inches">
                        </div>
                        <div class="form-group"><label for="frock_full_length">Full Length</label> <input type="text" id="frock_full_length">
                        </div>
                        <div class="form-group"><label for="frock_front_length">Front Length</label> <input type="text" id="frock_front_length">
                        </div>
                        <div class="form-group"><label for="frock_back_length">Back Length</label> <input type="text" id="frock_back_length">
                        </div>
                    </div>
                </div><!-- Kurti Measurements -->
                <div id="kurti-measurements" class="measurement-section" style="display: none;">
                    <h3>üìè Kurti Measurements</h3>
                    <div class="form-grid">
                        <div class="form-group"><label for="kurti_full_length">Full Length</label> <input type="text" id="kurti_full_length" placeholder="e.g., 42 inches">
                        </div>
                        <div class="form-group"><label for="kurti_waist">Waist</label> <input type="text" id="kurti_waist">
                        </div>
                        <div class="form-group"><label for="kurti_side_cut">Side Cut</label> <input type="text" id="kurti_side_cut">
                        </div>
                        <div class="form-group"><label for="kurti_collar_round">Collar Round</label> <input type="text" id="kurti_collar_round">
                        </div>
                        <div class="form-group"><label for="kurti_front_length">Front Length</label> <input type="text" id="kurti_front_length">
                        </div>
                        <div class="form-group"><label for="kurti_back_length">Back Length</label> <input type="text" id="kurti_back_length">
                        </div>
                    </div>
                </div><!-- Pant Measurements -->
                <div id="pant-measurements" class="measurement-section" style="display: none;">
                    <h3>üìè Pant Measurements</h3>
                    <div class="form-grid">
                        <div class="form-group"><label for="pant_full_length">Full Length</label> <input type="text" id="pant_full_length" placeholder="e.g., 38 inches">
                        </div>
                        <div class="form-group"><label for="pant_hips">Hips</label> <input type="text" id="pant_hips">
                        </div>
                        <div class="form-group"><label for="pant_knee">Knee</label> <input type="text" id="pant_knee">
                        </div>
                        <div class="form-group"><label for="pant_ankle">Ankle</label> <input type="text" id="pant_ankle">
                        </div>
                        <div class="form-group"><label for="pant_waist">Waist</label> <input type="text" id="pant_waist">
                        </div>
                        <div class="form-group"><label for="pant_thigh">Thigh</label> <input type="text" id="pant_thigh">
                        </div>
                        <div class="form-group"><label for="pant_knee_round">Knee Round</label> <input type="text" id="pant_knee_round">
                        </div>
                        <div class="form-group"><label for="pant_ankle_round">Ankle Round</label> <input type="text" id="pant_ankle_round">
                        </div>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group"><label for="notes">Additional Notes</label> <textarea id="notes" rows="3" placeholder="Any special instructions or notes..."></textarea>
                    </div>
                </div>
                <div style="margin-top: 25px;"><button type="submit" class="btn btn-primary" id="saveBtn"> <span id="saveBtnText">Save Customer</span> </button> <button type="button" class="btn btn-secondary" onclick="resetForm()">Clear Form</button>
                </div>
            </form>
        </div><!-- Search Customer Tab -->
        <div id="search-customer" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 25px;">üîç Search Customer</h2>
            <div class="search-section">
                <div class="search-grid">
                    <div class="form-group"><label for="searchName">Search by Name</label> <input type="text" id="searchName" placeholder="Enter customer name">
                    </div>
                    <div class="form-group"><label for="searchPhone">Search by Phone Number</label> <input type="tel" id="searchPhone" placeholder="Enter phone number">
                    </div>
                    <div class="form-group"><button class="btn btn-primary" onclick="searchCustomers()">Search</button>
                    </div>
                </div>
            </div>
            <div id="search-results"></div>
        </div><!-- All Customers Tab -->
        <div id="all-customers" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 25px;">üë• All Customers</h2>
            <div id="all-customers-list"></div>
        </div><!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 25px;">üìä Business Analytics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalCustomers">
                        0
                    </div>
                    <div class="stat-label">
                        Total Customers
                    </div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="stat-value" id="uniqueCustomers">
                        0
                    </div>
                    <div class="stat-label">
                        Unique Customers
                    </div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <div class="stat-value" id="totalRevenue">
                        ‚Çπ0
                    </div>
                    <div class="stat-label">
                        Total Revenue
                    </div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <div class="stat-value" id="avgBillAmount">
                        ‚Çπ0
                    </div>
                    <div class="stat-label">
                        Avg Bill Amount
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <h3 style="color: #667eea; margin-bottom: 20px;">Work Type Distribution</h3>
                <canvas id="workTypeChart"></canvas>
            </div>
            <div class="chart-container">
                <h3 style="color: #667eea; margin-bottom: 20px;">Garment Type Distribution</h3>
                <canvas id="garmentChart"></canvas>
            </div>
            <div class="chart-container">
                <h3 style="color: #667eea; margin-bottom: 20px;">Recent Transactions</h3>
                <div class="table-container">
                    <table id="recentCustomersTable">
                        <thead>
                        <tr>
                            <th>Name</th>
                            <th>Work Type</th>
                            <th>Garment Type</th>
                            <th>Work Date</th>
                            <th>Bill Amount</th>
                        </tr>
                        </thead>
                        <tbody id="recentCustomersBody">
                        <tr>
                            <td colspan="5" class="no-results">No transactions yet</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div><!-- Revenue Report Tab -->
        <div id="revenue-report" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 25px;">üí∞ Revenue Report</h2>
            <div class="date-filter-section">
                <h3 style="color: #667eea; margin-top: 0;">Filter by Date Range</h3>
                <div class="filter-grid">
                    <div class="form-group"><label for="startDate">Start Date</label> <input type="date" id="startDate">
                    </div>
                    <div class="form-group"><label for="endDate">End Date</label> <input type="date" id="endDate">
                    </div>
                    <div class="form-group"><button class="btn btn-primary" onclick="loadRevenueReport()">Generate Report</button>
                    </div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="reportTotalRevenue">
                        ‚Çπ0
                    </div>
                    <div class="stat-label">
                        Total Revenue
                    </div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="stat-value" id="reportUniqueCustomers">
                        0
                    </div>
                    <div class="stat-label">
                        Unique Customers
                    </div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <div class="stat-value" id="reportAvgBill">
                        ‚Çπ0
                    </div>
                    <div class="stat-label">
                        Avg Bill Amount
                    </div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <div class="stat-value" id="reportTotalOrders">
                        0
                    </div>
                    <div class="stat-label">
                        Total Orders
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <h3 style="color: #667eea; margin-bottom: 20px;">Daily Revenue Trend</h3>
                <canvas id="dailyRevenueChart"></canvas>
            </div>
            <div class="chart-container">
                <h3 style="color: #667eea; margin-bottom: 20px;">Work Type Revenue Distribution</h3>
                <canvas id="workTypeRevenueChart"></canvas>
            </div>
        </div>
    </main>
</div>
<script>
    const API_BASE_URL = 'http://localhost:8080/api/customers';
    let workTypeChart = null;
    let garmentChart = null;
    let dailyRevenueChart = null;
    let workTypeRevenueChart = null;

    // Switch between tabs
    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });

        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active');
        });

        document.getElementById(tabId).classList.add('active');
        event.target.classList.add('active');

        if (tabId === 'analytics') {
            loadAnalytics();
        } else if (tabId === 'all-customers') {
            loadAllCustomers();
        } else if (tabId === 'revenue-report') {
            loadRevenueReport();
        }
    }

    // Show/hide measurement fields based on garment type
    function showMeasurementFields() {
        const garmentType = document.getElementById('garmentType').value;

        // Hide all garment-specific measurement sections
        document.getElementById('lehenga-measurements').style.display = 'none';
        document.getElementById('frock-measurements').style.display = 'none';
        document.getElementById('kurti-measurements').style.display = 'none';
        document.getElementById('pant-measurements').style.display = 'none';

        // Always show blouse measurements for all garment types
        if (garmentType) {
            document.getElementById('blouse-measurements').style.display = 'block';

            // Show the specific garment measurement section
            const sectionId = garmentType + '-measurements';
            const section = document.getElementById(sectionId);
            if (section) {
                section.style.display = 'block';
            }
        } else {
            document.getElementById('blouse-measurements').style.display = 'none';
        }
    }

    // Collect measurements based on garment type
    function collectMeasurements() {
        const garmentType = document.getElementById('garmentType').value;
        const measurements = {
            blouse: {},
            garmentSpecific: {}
        };

        // Always collect blouse measurements for all garment types
        if (garmentType) {
            measurements.blouse = {
                type: document.getElementById('blouse_type').value,
                fullLength: document.getElementById('blouse_full_length').value,
                shoulder: document.getElementById('blouse_shoulder').value,
                armHole: document.getElementById('blouse_arm_hole').value,
                dotPoint: document.getElementById('blouse_dot_point').value,
                upperChest: document.getElementById('blouse_upper_chest').value,
                lowerChest: document.getElementById('blouse_lower_chest').value,
                chest: document.getElementById('blouse_chest').value,
                pointToApex: document.getElementById('blouse_point_to_apex').value,
                sleeveLength: document.getElementById('blouse_sleeve_length').value,
                biceps: document.getElementById('blouse_biceps').value,
                frontNeckDepth: document.getElementById('blouse_front_neck_depth').value,
                backNeckDepth: document.getElementById('blouse_back_neck_depth').value
            };
        }

        // Collect garment-specific measurements
        if (garmentType === 'blouse') {
            // For blouse-only orders, measurements are already in blouse section
            measurements.garmentSpecific = {};
        } else if (garmentType === 'lehenga') {
            measurements.garmentSpecific = {
                fullLength: document.getElementById('lehenga_full_length').value,
                waist: document.getElementById('lehenga_waist').value,
                type: document.getElementById('lehenga_type').value
            };
        } else if (garmentType === 'frock') {
            measurements.garmentSpecific = {
                bodyLength: document.getElementById('frock_body_length').value,
                fullLength: document.getElementById('frock_full_length').value,
                frontLength: document.getElementById('frock_front_length').value,
                backLength: document.getElementById('frock_back_length').value
            };
        } else if (garmentType === 'kurti') {
            measurements.garmentSpecific = {
                fullLength: document.getElementById('kurti_full_length').value,
                waist: document.getElementById('kurti_waist').value,
                sideCut: document.getElementById('kurti_side_cut').value,
                collarRound: document.getElementById('kurti_collar_round').value,
                frontLength: document.getElementById('kurti_front_length').value,
                backLength: document.getElementById('kurti_back_length').value
            };
        } else if (garmentType === 'pant') {
            measurements.garmentSpecific = {
                fullLength: document.getElementById('pant_full_length').value,
                hips: document.getElementById('pant_hips').value,
                knee: document.getElementById('pant_knee').value,
                ankle: document.getElementById('pant_ankle').value,
                waist: document.getElementById('pant_waist').value,
                thigh: document.getElementById('pant_thigh').value,
                kneeRound: document.getElementById('pant_knee_round').value,
                ankleRound: document.getElementById('pant_ankle_round').value
            };
        }

        return measurements;
    }

    // Save customer
    async function saveCustomer(event) {
        event.preventDefault();

        const saveBtn = document.getElementById('saveBtn');
        const saveBtnText = document.getElementById('saveBtnText');

        saveBtn.disabled = true;
        saveBtnText.innerHTML = '<span class="loading"></span> Saving...';

        const customerData = {
            customerName: document.getElementById('customerName').value,
            phoneNumber: document.getElementById('phoneNumber').value,
            address: document.getElementById('address').value,
            workDate: document.getElementById('workDate').value,
            deliveryDate: document.getElementById('deliveryDate').value,
            workType: document.getElementById('workType').value,
            garmentType: document.getElementById('garmentType').value,
            billAmount: parseFloat(document.getElementById('billAmount').value),
            measurements: collectMeasurements(),
            notes: document.getElementById('notes').value
        };

        try {
            const response = await fetch(API_BASE_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(customerData)
            });

            if (response.ok) {
                showAlert('‚úÖ Customer saved successfully!', 'success');
                resetForm();
            } else {
                const errorText = await response.text();
                showAlert('‚ùå Error saving customer: ' + errorText, 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showAlert('‚ùå Error connecting to server. Please check if the backend is running on port 8080.', 'error');
        } finally {
            saveBtn.disabled = false;
            saveBtnText.textContent = 'Save Customer';
        }
    }

    // Search customers
    async function searchCustomers() {
        const searchName = document.getElementById('searchName').value.trim();
        const searchPhone = document.getElementById('searchPhone').value.trim();

        if (!searchName && !searchPhone) {
            showAlert('‚ö†Ô∏è Please enter a name or phone number to search', 'error');
            return;
        }

        try {
            let customers = [];

            // Search by name
            if (searchName) {
                const response = await fetch(`${API_BASE_URL}/search/name?name=${encodeURIComponent(searchName)}`);
                customers = await response.json();
            }

            // Search by phone number (filter from all customers)
            if (searchPhone) {
                const response = await fetch(API_BASE_URL);
                const allCustomers = await response.json();
                const phoneResults = allCustomers.filter(customer =>
                    customer.phoneNumber && customer.phoneNumber.includes(searchPhone)
                );

                // If both name and phone are provided, find intersection
                if (searchName) {
                    customers = customers.filter(c1 =>
                        phoneResults.some(c2 => c1.id === c2.id)
                    );
                } else {
                    customers = phoneResults;
                }
            }

            displaySearchResults(customers);
        } catch (error) {
            console.error('Error:', error);
            showAlert('‚ùå Error searching customers. Please try again.', 'error');
        }
    }

    // Load all customers
    async function loadAllCustomers() {
        try {
            const response = await fetch(API_BASE_URL);
            const customers = await response.json();
            displayAllCustomers(customers);
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('all-customers-list').innerHTML =
                '<div class="no-results">‚ùå Error loading customers</div>';
        }
    }

    // Display all customers
    function displayAllCustomers(customers) {
        const container = document.getElementById('all-customers-list');

        if (customers.length === 0) {
            container.innerHTML = '<div class="no-results">No customers found</div>';
            return;
        }

        let html = '';
        customers.forEach(customer => {
            html += createCustomerCard(customer);
        });

        container.innerHTML = html;
    }

    // Display search results
    function displaySearchResults(customers) {
        const resultsContainer = document.getElementById('search-results');

        if (customers.length === 0) {
            resultsContainer.innerHTML = '<div class="no-results">No customers found</div>';
            return;
        }

        let html = '';
        customers.forEach(customer => {
            html += createCustomerCard(customer);
        });

        resultsContainer.innerHTML = html;
    }

    // Create customer card HTML
    function createCustomerCard(customer) {
        const measurements = typeof customer.measurements === 'string'
            ? JSON.parse(customer.measurements)
            : customer.measurements;

        return `
            <div class="customer-card">
                <div class="customer-header">
                    <div>
                        <div class="customer-name">${customer.customerName}</div>
                        <div class="customer-phone">üìû ${customer.phoneNumber}</div>
                    </div>
                    <div>
                        <div class="garment-type-badge">${customer.garmentType ? customer.garmentType.toUpperCase() : 'N/A'}</div>
                    </div>
                </div>
                <div style="margin-bottom: 10px;">
                    <strong>üìç Address:</strong> ${customer.address || 'N/A'}<br>
                    <strong>üîß Work Type:</strong> ${customer.workType || 'N/A'}<br>
                    <strong>üìÖ Work Date:</strong> ${customer.workDate || 'N/A'}<br>
                    <strong>üöö Delivery Date:</strong> ${customer.deliveryDate || 'N/A'}<br>
                    <strong>üí∞ Bill Amount:</strong> ‚Çπ${customer.billAmount ? customer.billAmount.toFixed(2) : '0.00'}
                </div>
                ${displayMeasurements(measurements, customer.garmentType)}
                ${customer.notes ? `<div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;"><strong>üìù Notes:</strong> ${customer.notes}</div>` : ''}
                <div class="customer-actions">
                    <button class="btn btn-danger" onclick="deleteCustomer(${customer.id})">Delete</button>
                </div>
            </div>
        `;
    }

    // Display measurements
    function displayMeasurements(measurements, garmentType) {
        if (!measurements || Object.keys(measurements).length === 0) {
            return '<div style="color: #666; font-style: italic;">No measurements recorded</div>';
        }

        const measurementLabels = {
            // Blouse measurements
            type: 'Blouse Type',
            fullLength: 'Full Length',
            shoulder: 'Shoulder',
            armHole: 'Arm Hole',
            dotPoint: 'Dot Point',
            upperChest: 'Upper Chest',
            lowerChest: 'Lower Chest',
            chest: 'Chest',
            pointToApex: 'Point to Apex',
            sleeveLength: 'Sleeve Length',
            biceps: 'Biceps',
            frontNeckDepth: 'Front Neck Depth',
            backNeckDepth: 'Back Neck Depth',
            // Garment-specific measurements
            waist: 'Waist',
            type: 'Type',
            bodyLength: 'Body Length',
            frontLength: 'Front Length',
            backLength: 'Back Length',
            sideCut: 'Side Cut',
            collarRound: 'Collar Round',
            hips: 'Hips',
            knee: 'Knee',
            ankle: 'Ankle',
            thigh: 'Thigh',
            kneeRound: 'Knee Round',
            ankleRound: 'Ankle Round'
        };

        let html = '';

        // Display blouse measurements if available
        if (measurements.blouse && Object.keys(measurements.blouse).length > 0) {
            html += '<div style="margin-bottom: 15px;"><strong style="color: #667eea; font-size: 1.1em;">üëó Blouse Measurements:</strong></div>';
            html += '<div class="measurements-display">';
            for (const [key, value] of Object.entries(measurements.blouse)) {
                if (value) {
                    html += `
                        <div class="measurement-item">
                            <div class="measurement-label">${measurementLabels[key] || key}</div>
                            <div class="measurement-value">${value}</div>
                        </div>
                    `;
                }
            }
            html += '</div>';
        }

        // Display garment-specific measurements if available
        if (measurements.garmentSpecific && Object.keys(measurements.garmentSpecific).length > 0) {
            const hasValues = Object.values(measurements.garmentSpecific).some(v => v);
            if (hasValues) {
                html += '<div style="margin: 20px 0 15px 0;"><strong style="color: #764ba2; font-size: 1.1em;">üìê ' + (garmentType ? garmentType.charAt(0).toUpperCase() + garmentType.slice(1) : 'Garment') + ' Measurements:</strong></div>';
                html += '<div class="measurements-display">';
                for (const [key, value] of Object.entries(measurements.garmentSpecific)) {
                    if (value) {
                        html += `
                            <div class="measurement-item">
                                <div class="measurement-label">${measurementLabels[key] || key}</div>
                                <div class="measurement-value">${value}</div>
                            </div>
                        `;
                    }
                }
                html += '</div>';
            }
        }

        // Fallback for old data format (flat structure)
        if (!measurements.blouse && !measurements.garmentSpecific) {
            html = '<div class="measurements-display">';
            for (const [key, value] of Object.entries(measurements)) {
                if (value) {
                    html += `
                        <div class="measurement-item">
                            <div class="measurement-label">${measurementLabels[key] || key}</div>
                            <div class="measurement-value">${value}</div>
                        </div>
                    `;
                }
            }
            html += '</div>';
        }

        return html || '<div style="color: #666; font-style: italic;">No measurements recorded</div>';
    }

    // Delete customer
    async function deleteCustomer(customerId) {
        if (!confirm('Are you sure you want to delete this customer?')) {
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/${customerId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                showAlert('‚úÖ Customer deleted successfully!', 'success');
                loadAllCustomers();
                loadAnalytics();
            } else {
                showAlert('‚ùå Error deleting customer', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showAlert('‚ùå Error deleting customer', 'error');
        }
    }

    // Load analytics
    async function loadAnalytics() {
        try {
            const [customersRes, statsRes, workTypeRes, recentRes] = await Promise.all([
                fetch(API_BASE_URL),
                fetch(`${API_BASE_URL}/analytics/stats`),
                fetch(`${API_BASE_URL}/analytics/work-type-distribution`),
                fetch(`${API_BASE_URL}/recent`)
            ]);

            const customers = await customersRes.json();
            const stats = await statsRes.json();
            const workTypeData = await workTypeRes.json();
            const recentCustomers = await recentRes.json();

            document.getElementById('totalCustomers').textContent = customers.length;
            document.getElementById('uniqueCustomers').textContent = stats.uniqueCustomers || 0;
            document.getElementById('totalRevenue').textContent = '‚Çπ' + (stats.totalRevenue || 0).toFixed(2);
            document.getElementById('avgBillAmount').textContent = '‚Çπ' + (stats.averageBillAmount || 0).toFixed(2);

            updateWorkTypeChart(workTypeData);
            updateGarmentChart(customers);
            updateRecentCustomersTable(recentCustomers);
        } catch (error) {
            console.error('Error loading analytics:', error);
        }
    }

    // Update work type chart
    function updateWorkTypeChart(workTypeData) {
        const ctx = document.getElementById('workTypeChart').getContext('2d');

        if (workTypeChart) {
            workTypeChart.destroy();
        }

        const labels = workTypeData.map(item => item.workType);
        const data = workTypeData.map(item => item.count);

        workTypeChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        'rgba(102, 126, 234, 0.8)',
                        'rgba(118, 75, 162, 0.8)',
                        'rgba(240, 147, 251, 0.8)',
                        'rgba(245, 87, 108, 0.8)',
                        'rgba(79, 172, 254, 0.8)'
                    ],
                    borderColor: [
                        'rgba(102, 126, 234, 1)',
                        'rgba(118, 75, 162, 1)',
                        'rgba(240, 147, 251, 1)',
                        'rgba(245, 87, 108, 1)',
                        'rgba(79, 172, 254, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }

    // Update garment chart
    function updateGarmentChart(customers) {
        const garmentCounts = {};
        customers.forEach(customer => {
            const type = customer.garmentType || 'Unknown';
            garmentCounts[type] = (garmentCounts[type] || 0) + 1;
        });

        const ctx = document.getElementById('garmentChart').getContext('2d');

        if (garmentChart) {
            garmentChart.destroy();
        }

        garmentChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(garmentCounts).map(k => k.charAt(0).toUpperCase() + k.slice(1)),
                datasets: [{
                    label: 'Number of Orders',
                    data: Object.values(garmentCounts),
                    backgroundColor: [
                        'rgba(102, 126, 234, 0.8)',
                        'rgba(118, 75, 162, 0.8)',
                        'rgba(240, 147, 251, 0.8)',
                        'rgba(245, 87, 108, 0.8)',
                        'rgba(79, 172, 254, 0.8)'
                    ],
                    borderColor: [
                        'rgba(102, 126, 234, 1)',
                        'rgba(118, 75, 162, 1)',
                        'rgba(240, 147, 251, 1)',
                        'rgba(245, 87, 108, 1)',
                        'rgba(79, 172, 254, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    // Update recent customers table
    function updateRecentCustomersTable(customers) {
        const tbody = document.getElementById('recentCustomersBody');

        if (customers.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="no-results">No transactions yet</td></tr>';
            return;
        }

        let html = '';
        customers.forEach(customer => {
            html += `
                <tr>
                    <td>${customer.customerName}</td>
                    <td><span style="background: #667eea; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85em;">${customer.workType || 'N/A'}</span></td>
                    <td><span style="background: #764ba2; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85em;">${customer.garmentType ? customer.garmentType.toUpperCase() : 'N/A'}</span></td>
                    <td>${customer.workDate || 'N/A'}</td>
                    <td style="font-weight: 600; color: #43e97b;">‚Çπ${customer.billAmount ? customer.billAmount.toFixed(2) : '0.00'}</td>
                </tr>
            `;
        });

        tbody.innerHTML = html;
    }

    // Load revenue report
    async function loadRevenueReport() {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;

        try {
            let statsUrl = `${API_BASE_URL}/analytics/stats`;
            let dailyRevenueUrl = `${API_BASE_URL}/analytics/daily-revenue`;
            let workTypeUrl = `${API_BASE_URL}/analytics/work-type-distribution`;
            let customersUrl = API_BASE_URL;

            if (startDate && endDate) {
                statsUrl += `?startDate=${startDate}&endDate=${endDate}`;
                dailyRevenueUrl += `?startDate=${startDate}&endDate=${endDate}`;
                workTypeUrl += `?startDate=${startDate}&endDate=${endDate}`;
                customersUrl += `/search/date-range?startDate=${startDate}&endDate=${endDate}`;
            }

            const [statsRes, dailyRevenueRes, workTypeRes, customersRes] = await Promise.all([
                fetch(statsUrl),
                fetch(dailyRevenueUrl),
                fetch(workTypeUrl),
                fetch(customersUrl)
            ]);

            const stats = await statsRes.json();
            const dailyRevenue = await dailyRevenueRes.json();
            const workTypeData = await workTypeRes.json();
            const customers = await customersRes.json();

            document.getElementById('reportTotalRevenue').textContent = '‚Çπ' + (stats.totalRevenue || 0).toFixed(2);
            document.getElementById('reportUniqueCustomers').textContent = stats.uniqueCustomers || 0;
            document.getElementById('reportAvgBill').textContent = '‚Çπ' + (stats.averageBillAmount || 0).toFixed(2);
            document.getElementById('reportTotalOrders').textContent = customers.length;

            updateDailyRevenueChart(dailyRevenue);
            updateWorkTypeRevenueChart(workTypeData);
        } catch (error) {
            console.error('Error loading revenue report:', error);
        }
    }

    // Update daily revenue chart
    function updateDailyRevenueChart(dailyRevenue) {
        const ctx = document.getElementById('dailyRevenueChart').getContext('2d');

        if (dailyRevenueChart) {
            dailyRevenueChart.destroy();
        }

        const labels = dailyRevenue.map(item => item.date);
        const data = dailyRevenue.map(item => item.revenue);

        dailyRevenueChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Daily Revenue (‚Çπ)',
                    data: data,
                    backgroundColor: 'rgba(102, 126, 234, 0.2)',
                    borderColor: 'rgba(102, 126, 234, 1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                plugins: {
                    legend: {
                        display: true
                    }
                }
            }
        });
    }

    // Update work type revenue chart
    function updateWorkTypeRevenueChart(workTypeData) {
        const ctx = document.getElementById('workTypeRevenueChart').getContext('2d');

        if (workTypeRevenueChart) {
            workTypeRevenueChart.destroy();
        }

        const labels = workTypeData.map(item => item.workType);
        const data = workTypeData.map(item => item.count);

        workTypeRevenueChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        'rgba(102, 126, 234, 0.8)',
                        'rgba(118, 75, 162, 0.8)',
                        'rgba(240, 147, 251, 0.8)',
                        'rgba(245, 87, 108, 0.8)',
                        'rgba(79, 172, 254, 0.8)'
                    ],
                    borderColor: [
                        'rgba(102, 126, 234, 1)',
                        'rgba(118, 75, 162, 1)',
                        'rgba(240, 147, 251, 1)',
                        'rgba(245, 87, 108, 1)',
                        'rgba(79, 172, 254, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }

    // Show alert message
    function showAlert(message, type) {
        const alertContainer = document.getElementById('alert-container');
        const alertClass = type === 'success' ? 'alert-success' : 'alert-error';

        alertContainer.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;

        setTimeout(() => {
            alertContainer.innerHTML = '';
        }, 5000);
    }

    // Reset form
    function resetForm() {
        document.getElementById('customerForm').reset();
        document.querySelectorAll('.measurement-section').forEach(section => {
            section.style.display = 'none';
        });
    }

    // Initialize on page load
    window.addEventListener('load', () => {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('workDate').value = today;
    });
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99d70567e291473d',t:'MTc2Mjk2MDkwOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>